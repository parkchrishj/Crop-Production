<!doctype html>
<html class="no-js" lang="en">

<head>
    <meta charset="utf-8">

    <!--====== Title ======-->
    <title>Crop Production with Agricultural Fertilizers and Pesticides</title>

    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="assets/images/favicon.png" type="image/png">

    <!--====== Animate CSS ======-->
    <link rel="stylesheet" href="assets/css/animate.css">

    <!--====== Glide CSS ======-->
    <link rel="stylesheet" href="assets/css/tiny-slider.css">

    <!--====== Line Icons CSS ======-->
    <link rel="stylesheet" href="assets/css/LineIcons.2.0.css">

    <!--====== Bootstrap CSS ======-->
    <link rel="stylesheet" href="assets/css/bootstrap-5.0.0-beta1.min.css">

    <!--====== Default CSS ======-->
    <link rel="stylesheet" href="assets/css/default.css">

    <!--====== Style CSS ======-->
    <link rel="stylesheet" href="assets/css/style.css">

    <!--====== d3js ======-->
    <script src="https://d3js.org/d3.v6.js"></script>


</head>

<body>
    <!--[if IE]>
    <p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security.</p>
  <![endif]-->

    <!--====== PRELOADER PART START ======-->

    <div class="preloader">
        <div class="loader">
            <div class="ytp-spinner">
                <div class="ytp-spinner-container">
                    <div class="ytp-spinner-rotator">
                        <div class="ytp-spinner-left">
                            <div class="ytp-spinner-circle"></div>
                        </div>
                        <div class="ytp-spinner-right">
                            <div class="ytp-spinner-circle"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!--====== PRELOADER PART ENDS ======-->

    <!--====== HEADER PART START ======-->

    <section id="home" class="header_area">
        <div id="header_navbar" class="header_navbar">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <nav class="navbar navbar-expand-lg">
                            <a class="navbar-brand" href="index.html">
                                <img id="logo" src="assets/images/logo.svg" alt="Logo">
                            </a>
                            <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                aria-expanded="false" aria-label="Toggle navigation">
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                                <span class="toggler-icon"></span>
                            </button>

                            <div class="collapse navbar-collapse sub-menu-bar" id="navbarSupportedContent">
                                <ul id="nav" class="navbar-nav ms-auto">
                                    <li class="nav-item">
                                        <a class="page-scroll active" href="#home">Home</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="page-scroll" href="#about">Crop Production</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="page-scroll" href="#services">Chemical Additives Usage</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="page-scroll" href="#portfolio">World Map</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="page-scroll" href="#team">Crop Yield</a>
                                    </li>
                                </ul>
                            </div> <!-- navbar collapse -->
                        </nav> <!-- navbar -->
                    </div>
                </div> <!-- row -->
            </div> <!-- container -->
        </div> <!-- header navbar -->

        <div class="header_hero">
            <div class="single_hero bg_cover d-flex align-items-center"
                style="background-image: url(assets/images/crops_image.jpeg)">
                <div class="container">
                    <div class="row justify-content-center">
                        <div class="col-lg-8 col-md-10">
                            <div class="hero_content text-center">
                                <h2 class="hero_title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">Crop
                                    Production with </br> Agricultural Fertilizers and Pesticides</h2>
                                <p class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.5s">The Narrative
                                    Visualization will explore the effects of agricultural chemical additives, <br
                                        class="d-none d-xl-block"> such as Fertilizers and Pesticides, on the production
                                    rate of crops between Year 2002 and 2018.</p>
                                <a href="#about" class="main-btn wow fadeInUp" data-wow-duration="1.3s"
                                    data-wow-delay="0.8s">Explore</a>
                            </div> <!-- hero content -->
                        </div>
                    </div> <!-- row -->
                </div> <!-- container -->
            </div> <!-- single hero -->
        </div> <!-- header hero -->
    </section>

    <!--====== HEADER PART ENDS ======-->

    <!--====== ABOUT PART START ======-->

    <section id="about" class="pt-130">
        <div class="about_area">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-8 col-md-10">
                        <div class="about_content pt-120 pb-130">
                            <h4 class="title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">AVG. Crop
                                Production Visual Comparison of Both Pesticide and Fertilizer Usage Relative to Nations
                            </h4>
                            <!-- Create a div where the graph will take place -->
                            <div class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s"
                                id="scatterplot_crop_output"></div>
                            <!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
                            <style>
                                .bubbles {
                                    stroke-width: 1px;
                                    stroke: black;
                                    opacity: .8
                                }

                                .bubbles:hover {
                                    stroke: orange;
                                }
                            </style>
                            <script>
                                // set the dimensions and margins of the graph
                                const margin = { top: 40, right: 150, bottom: 60, left: 60 },
                                    width = 900 - margin.left - margin.right,
                                    height = 420 - margin.top - margin.bottom;
                                const svg = d3.select("#scatterplot_crop_output")
                                    .append("svg")
                                    .attr("width", width + margin.left + margin.right)
                                    .attr("height", height + margin.top + margin.bottom)
                                    .append("g")
                                    .attr("transform", `translate(${margin.left},${margin.top})`);
                                d3.csv("https://raw.githubusercontent.com/parkchrishj/Crop-Production/main/assets/Crops/Crop_Production.csv")
                                    .then(function (data) {
                                        // x axis
                                        const x = d3.scaleLinear().domain([0, 400000]).range([0, width - 200]);
                                        svg.append("g")
                                            .attr("transform", `translate(0, ${height})`)
                                            .call(d3.axisBottom(x).ticks(8));
                                        // const x = d3.scaleLog().domain([0, 1000000]).range([0, width]);
                                        // svg.append("g")
                                        //     .attr("transform", `translate(0, ${height})`)
                                        //     .call(d3.axisBottom(x).ticks(4).tickFormat(d3.format("~s")));
                                        svg.append("text")
                                            .attr("text-anchor", "end")
                                            .attr("x", width - 300)
                                            .attr("y", height + 50)
                                            .text("Agricultural Pesticides Used (Tonnes)");
                                        // y axis
                                        const y = d3.scaleLinear().domain([0, 50000000]).range([height, 0]);
                                        svg.append("g")
                                            .call(d3.axisLeft(y).ticks(10));
                                        svg.append("text")
                                            .attr("text-anchor", "end")
                                            .attr("x", -60)
                                            .attr("y", -20)
                                            .text("Agricultural Fertilizers Used (Tonnes)")
                                            .attr("text-anchor", "start")
                                        // Add a scale for bubble size
                                        const z = d3.scaleSqrt()
                                            .domain([200000, 13100000000])
                                            .range([2, 50]);
                                        // Add a scale for bubble color
                                        allgroups = new Set(data.map(d => d.Income_Group))//= ["High-income economies", "Upper-middle-income economies", "Lower-middle-income economies", "Low income economies"]
                                        // yeargroups = new Set(data.map(d => d.Year).sort(d3.ascending))
                                        // add the options to the button
                                        const myColor = d3.scaleOrdinal()
                                            .domain(allgroups)
                                            .range(d3.schemeSet1);
                                        // ---------------------------//
                                        //      TOOLTIP               //
                                        // ---------------------------//

                                        // -1- Create a tooltip div that is hidden by default:
                                        var tooltip = d3.select("#scatterplot_crop_output")
                                            .append("div")
                                            .style("opacity", 0)
                                            .attr("class", "tooltip")
                                            .style("background-color", "black")
                                            .style("border-radius", "5px")
                                            .style("padding", "10px")
                                            .style("color", "white")

                                        // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
                                        const showTooltip = function (event, d) {
                                            tooltip
                                                .transition()
                                                .duration(200)
                                            tooltip
                                                .style("opacity", 1)
                                                .html("Country: " + d.country)
                                                .style("left", (event.x) / 2 + "px")
                                                .style("top", (event.y) / 2 - 50 + "px")
                                        }
                                        const moveTooltip = function (event, d) {
                                            tooltip
                                                .style("left", (event.x) / 2 + width / 2 + "px")
                                                .style("top", (event.y) / 2 + "px")
                                        }
                                        const hideTooltip = function (event, d) {
                                            tooltip
                                                .transition()
                                                .duration(200)
                                                .style("opacity", 0)
                                        }

                                        // ---------------------------//
                                        //       HIGHLIGHT GROUP      //
                                        // ---------------------------//
                                        // What to do when one group is hovered
                                        const highlight = function (event, d) {
                                            // reduce opacity of all groups
                                            d3.selectAll(".bubbles").style("opacity", 1)
                                            // expect the one that is hovered
                                            // d3.selectAll("." + d).style("opacity", 1)
                                        }

                                        // And when it is not hovered anymore
                                        const noHighlight = function (event, d) {
                                            d3.selectAll(".bubbles").style("opacity", 1)
                                        }


                                        // ---------------------------//
                                        //       CIRCLES              //
                                        // ---------------------------//
                                        const dotto = svg.append('g')
                                            .selectAll("dot")
                                            .data(data)
                                            .join("circle")
                                            .attr("class", function (d) { return "bubbles " + d.Income_Group })
                                            .attr("cx", d => x(d.Pesticide_x))
                                            .attr("cy", d => y(d.Fertilizers_y))
                                            .attr("r", d => z(d.Prod_value))
                                            .style("fill", d => myColor(d.Income_Group))
                                            // -3- Trigger the functions for hover
                                            .on("mouseover", showTooltip)
                                            .on("mousemove", moveTooltip)
                                            .on("mouseleave", hideTooltip)
                                        // ---------------------------//
                                        //       LEGEND              //
                                        // ---------------------------//

                                        // Add legend: circles
                                        const valuesToShow = [10000000, 100000000, 1000000000]
                                        const xCircle = 590
                                        const xLabel = 620
                                        svg
                                            .selectAll("legend")
                                            .data(valuesToShow)
                                            .join("circle")
                                            .attr("cx", xCircle)
                                            .attr("cy", d => height - 100 - z(d))
                                            .attr("r", d => z(d))
                                            .style("fill", "none")
                                            .attr("stroke", "black")

                                        // Add legend: segments
                                        svg
                                            .selectAll("legend")
                                            .data(valuesToShow)
                                            .join("line")
                                            .attr('x1', d => xCircle + z(d))
                                            .attr('x2', xLabel)
                                            .attr('y1', d => height - 100 - z(d))
                                            .attr('y2', d => height - 100 - z(d))
                                            .attr('stroke', 'black')
                                            .style('stroke-dasharray', ('2,2'))

                                        // Add legend: labels
                                        svg
                                            .selectAll("legend")
                                            .data(valuesToShow)
                                            .join("text")
                                            .attr('x', xLabel)
                                            .attr('y', d => height - 100 - z(d))
                                            .text(d => d / 1000000)
                                            .style("font-size", 10)
                                            .attr('alignment-baseline', 'middle')

                                        // Legend title
                                        svg.append("text")
                                            .attr('x', xCircle)
                                            .attr("y", height - 100 + 30)
                                            .text("Hectogram (Hg)")
                                            .attr("text-anchor", "middle")
                                        //annotation
                                        svg.append("text")
                                            .attr('x', 320)
                                            .attr("y", height - 180)
                                            .text("Countries with more chemical additives produced more crops")
                                            .attr("text-anchor", "middle")
                                            .style("font-size", "11px")

                                        svg.append("text")
                                            .attr('x', 80)
                                            .attr("y", height - 193)
                                            .text("----------------->")
                                            .attr("transform", "translate(20," + (height / 2) + ") rotate(-35)")
                                            .attr("text-anchor", "middle")
                                        // Add one dot in the legend for each name.
                                        const size = 20
                                        svg.selectAll("myrect")
                                            .data(allgroups)
                                            .join("circle")
                                            .attr("cx", 530)
                                            .attr("cy", (d, i) => 10 + i * (size + 5)) // 100 is where the first dot appears. 25 is the distance between dots
                                            .attr("r", 7)
                                            .style("fill", d => myColor(d))

                                        // Add labels beside legend dots
                                        svg.selectAll("mylabels")
                                            .data(allgroups)
                                            .enter()
                                            .append("text")
                                            .attr("x", 530 + size * .8)
                                            .attr("y", (d, i) => i * (size + 5) + (size / 2)) // 100 is where the first dot appears. 25 is the distance between dots
                                            .style("fill", d => myColor(d))
                                            .text(d => d)
                                            .attr("text-anchor", "left")
                                            .style("alignment-baseline", "middle")
                                    })

                            </script>

                        </div> <!-- section title -->
                    </div> <!-- about content -->
                </div>
            </div> <!-- row -->
        </div> <!-- container -->
        </div>
    </section>

    <!--====== ABOUT PART ENDS ======-->


    <!--====== FEATURES PART START ======-->

    <section id="services" class="features_area pt-120">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="section_title text-center pb-25">
                        <h4 class="title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">Pesticide and
                            Fertilizer Usage Relative to Nations</h4>
                        <p class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s"> </p>
                        <div id="circbubbles" class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s"></div>
                        <script>

                            // set the dimensions and margins of the graph
                            const width_circle = 400
                            const height_circle = 400

                            // append the svg object to the body of the page
                            const svg_bubbles = d3.select("#circbubbles")
                                .append("svg")
                                .attr("width", width_circle)
                                .attr("height", height_circle)

                            // Read data
                            d3.csv("https://raw.githubusercontent.com/parkchrishj/Crop-Production/main/assets/Crops/Crop_Production.csv").then(function (data) {


                                // Color palette for continents?
                                const color_c = d3.scaleOrdinal()
                                    .domain(allgroups)
                                    .range(d3.schemeSet1);

                                // Size scale for countries
                                const size_c = d3.scaleLinear()
                                    .domain([0, 80000000])
                                    .range([3, 65])  // circle will be between 7 and 55 px wide

                                // create a tooltip
                                const Tooltip_c = d3.select("#circbubbles")
                                    .append("div")
                                    .style("opacity", 0)
                                    .attr("class", "tooltip")
                                    .style("background-color", "white")
                                    .style("border", "solid")
                                    .style("border-width", "2px")
                                    .style("border-radius", "5px")
                                    .style("padding", "5px")

                                // Three function that change the tooltip when user hover / move / leave a cell
                                const mouseover_c = function (event, d) {
                                    Tooltip_c
                                        .transition()
                                        .duration(200)
                                    Tooltip_c
                                        .style("opacity", 1)
                                        .html('<u>' + d.country + '</u>' + "<br>" + (+d.Fertilizers_y + +d.Pesticide_x) + " tonnes")

                                }

                                // Initialize the circle: all located at the center of the svg area
                                var node = svg_bubbles.append("g")
                                    .selectAll("circle")
                                    .data(data)
                                    .join("circle")
                                    .attr("class", "node")
                                    .attr("r", d => size_c(+d.Fertilizers_y + +d.Pesticide_x))
                                    .attr("cx", 10)
                                    .attr("cy", 20)
                                    .style("fill", d => color_c(d.Income_Group))
                                    .style("fill-opacity", 0.8)
                                    .attr("stroke", "black")
                                    .style("stroke-width", 1)
                                    .on("mouseover", mouseover_c) // What to do when hovered
                                    .call(d3.drag() // call specific function when circle is dragged
                                        .on("start", dragstarted)
                                        .on("drag", dragged)
                                        .on("end", dragended));

                                // Features of the forces applied to the nodes:
                                const simulation = d3.forceSimulation()
                                    .force("center", d3.forceCenter().x(width_circle / 2).y(height_circle / 2)) // Attraction to the center of the svg area
                                    .force("charge", d3.forceManyBody().strength(.1)) // Nodes are attracted one each other of value is > 0
                                    .force("collide", d3.forceCollide().strength(.2).radius(function (d) { return (size_c(d.Fertilizers_y) + 3) }).iterations(1)) // Force that avoids circle overlapping

                                // Apply these forces to the nodes and update their positions.
                                // Once the force algorithm is happy with positions ('alpha' value is low enough), simulations will stop.
                                simulation
                                    .nodes(data)
                                    .on("tick", function (d) {
                                        node
                                            .attr("cx", d => d.x)
                                            .attr("cy", d => d.y)
                                    });

                                // What happens when a circle is dragged?
                                function dragstarted(event, d) {
                                    if (!event.active) simulation.alphaTarget(.03).restart();
                                    d.fx = d.x;
                                    d.fy = d.y;
                                }
                                function dragged(event, d) {
                                    d.fx = event.x;
                                    d.fy = event.y;
                                }
                                function dragended(event, d) {
                                    if (!event.active) simulation.alphaTarget(.03);
                                    d.fx = null;
                                    d.fy = null;
                                }
                                const size = 20
                                svg_bubbles.selectAll("myrect")
                                    .data(allgroups)
                                    .join("circle")
                                    .attr("cx", 10)
                                    .attr("cy", (d, i) => 10 + i * (size + 5)) // 100 is where the first dot appears. 25 is the distance between dots
                                    .attr("r", 7)
                                    .style("fill", d => color_c(d))

                                // Add labels beside legend dots
                                svg_bubbles.selectAll("mylabels")
                                    .data(allgroups)
                                    .enter()
                                    .append("text")
                                    .attr("x", 10 + size * .8)
                                    .attr("y", (d, i) => i * (size + 5) + (size / 2)) // 100 is where the first dot appears. 25 is the distance between dots
                                    .style("fill", d => color_c(d))
                                    .text(d => d)
                                    .attr("text-anchor", "left")
                                    .style("alignment-baseline", "middle")
                            })

                        </script>
                    </div> <!-- section title -->
                </div>
            </div> <!-- row -->

        </div> <!-- container -->
    </section>

    <!--====== FEATURES PART ENDS ======-->

    <!--====== PORTFOLIO PART START ======-->

    <section id="portfolio" class="portfolio_area pt-120">
        <div class="about_area">
            <div class="container">
                <div class="row justify-content-center">
                    <div class="col-lg-6">
                        <div class="section_title text-center pb-60">
                            <h4 class="title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">World Map of
                                AVG. Crop Production
                            </h4>
                            <p class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s">
                                A world choropleth map of
                                crop production would help us understand that countries with higher crop production are
                                larger countries.
                            </p>
                            <svg id="mapping" width="800" height="300"></svg>
                            <script>
                                // The svg
                                const mappery = d3.select("#mapping"),
                                    map_width = +svg.attr("width"),
                                    map_height = +svg.attr("height");

                                // Map and projection
                                const path = d3.geoPath();
                                const projection = d3.geoMercator()
                                    .scale(70)
                                    .center([0, 20])
                                    .translate([map_width / 2 + 300, map_height / 2 + 200]);

                                // Data and color scale
                                let data = new Map()
                                const colorScale = d3.scaleThreshold()
                                    .domain([100000, 1000000, 10000000, 30000000, 100000000, 500000000])
                                    .range(d3.schemeBlues[7]);

                                Promise.all([
                                    d3.json("https://raw.githubusercontent.com/holtzy/D3-graph-gallery/master/DATA/world.geojson"),
                                    d3.csv("https://raw.githubusercontent.com/parkchrishj/Crop-Production/main/assets/Crops/Prod_Quantity_Crops.csv", function (d) {
                                        data.set(d.iso3, +d.prod_avg_value)
                                    })
                                ]).then(function (loadData) {
                                    let topo = loadData[0]
                                    //Draw the map
                                    let mouseOver_m = function (d) {
                                        d3.selectAll(".Country")
                                            .transition()
                                            .duration(200)
                                            .style("opacity", .5)
                                        d3.select(this)
                                            .transition()
                                            .duration(200)
                                            .style("opacity", 1)
                                            .style("stroke", "black")
                                    }

                                    let mouseLeave_m = function (d) {
                                        d3.selectAll(".Country")
                                            .transition()
                                            .duration(200)
                                            .style("opacity", .8)
                                        d3.select(this)
                                            .transition()
                                            .duration(200)
                                            .style("stroke", "transparent")
                                    }

                                    mappery.append("g")
                                        .selectAll("path")
                                        .data(topo.features)
                                        .join("path")
                                        // draw each country
                                        .attr("d", d3.geoPath()
                                            .projection(projection)
                                        )
                                        // set the color of each country
                                        .attr("fill", function (d) {
                                            // if (d.year == "2010") {
                                            d.total = data.get(d.id) || 0;
                                            return colorScale(d.total);
                                            // }
                                        })
                                        .style("stroke", "transparent")
                                        .attr("class", function (d) { return "Country" })
                                        .style("opacity", .8)
                                        .on("mouseover", mouseOver_m)
                                        .on("mouseleave", mouseLeave_m)

                                    //annotation
                                    mappery.append("text")
                                        .attr('x', 400)
                                        .attr("y", height - 280)
                                        .text("Larger Countries produce more crops")
                                        .attr("text-anchor", "middle")
                                        .style("font-size", "11px")
                                })
                            </script>
                        </div> <!-- section title -->
                    </div>
                </div> <!-- row -->
            </div> <!-- container -->

        </div>
    </section>

    <!--====== PORTFOLIO PART ENDS ======-->

    <!--====== TEAM PART START ======-->

    <section id="team" class="team_area pt-120 pb-130">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-10">
                    <div class="section_title text-center pb-25">
                        <h4 class="title wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.2s">AVG. Crop Yield
                            Visual Comparison</h4>
                        <p class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s">Countries with higher
                            crop production have more arable land, so the next step is to look
                            for the average crop yield rate for all the countries in order to better understand the
                            effects of
                            chemical additives to crop production.</p>
                        <div class="wow fadeInUp" data-wow-duration="1.3s" data-wow-delay="0.4s"
                            id="scatterplot_crop_yield"></div>
                        <!-- A bit of CSS: change stroke color of circle on hover (white -> black) -->
                        <style>
                            .bubbles {
                                stroke-width: 1px;
                                stroke: black;
                                opacity: .8
                            }

                            .bubbles:hover {
                                stroke: orange;
                            }
                        </style>
                        <script>
                            // set the dimensions and margins of the graph
                            // const margin = { top: 40, right: 150, bottom: 60, left: 60 },
                            //   width = 900 - margin.left - margin.right,
                            //   height = 420 - margin.top - margin.bottom;
                            const svg_y = d3.select("#scatterplot_crop_yield")
                                .append("svg")
                                .attr("width", width + margin.left + margin.right)
                                .attr("height", height + margin.top + margin.bottom)
                                .append("g")
                                .attr("transform", `translate(${margin.left},${margin.top})`);
                            d3.csv("https://raw.githubusercontent.com/parkchrishj/Crop-Production/main/assets/Crops/Crop_Yield.csv")
                                .then(function (data) {
                                    // x axis
                                    const x = d3.scaleLinear().domain([0, 400000]).range([0, width - 200]);
                                    svg_y.append("g")
                                        .attr("transform", `translate(0, ${height})`)
                                        .call(d3.axisBottom(x).ticks(8));
                                    // const x = d3.scaleLog().domain([0, 1000000]).range([0, width]);
                                    // svg.append("g")
                                    //     .attr("transform", `translate(0, ${height})`)
                                    //     .call(d3.axisBottom(x).ticks(4).tickFormat(d3.format("~s")));
                                    svg_y.append("text")
                                        .attr("text-anchor", "end")
                                        .attr("x", width - 300)
                                        .attr("y", height + 50)
                                        .text("Agricultural Pesticides Used (Tonnes)");
                                    // y axis
                                    const y = d3.scaleLinear().domain([0, 50000000]).range([height, 0]);
                                    svg_y.append("g")
                                        .call(d3.axisLeft(y).ticks(10));
                                    svg_y.append("text")
                                        .attr("text-anchor", "end")
                                        .attr("x", -60)
                                        .attr("y", -20)
                                        .text("Agricultural Fertilizers Used (Tonnes)")
                                        .attr("text-anchor", "start")
                                    // Add a scale for bubble size
                                    const z = d3.scaleSqrt()
                                        .domain([1000, 400000000])
                                        .range([2, 50]);
                                    // Add a scale for bubble color
                                    allgroups = new Set(data.map(d => d.Income_Group))//= ["High-income economies", "Upper-middle-income economies", "Lower-middle-income economies", "Low income economies"]
                                    // yeargroups = new Set(data.map(d => d.Year).sort(d3.ascending))
                                    // add the options to the button
                                    const myColor = d3.scaleOrdinal()
                                        .domain(allgroups)
                                        .range(d3.schemeSet1);
                                    // ---------------------------//
                                    //      TOOLTIP               //
                                    // ---------------------------//

                                    // -1- Create a tooltip div that is hidden by default:
                                    var tooltip_y = d3.select("#scatterplot_crop_yield")
                                        .append("div")
                                        .style("opacity", 0)
                                        .attr("class", "tooltip")
                                        .style("background-color", "black")
                                        .style("border-radius", "5px")
                                        .style("padding", "10px")
                                        .style("color", "white")

                                    // -2- Create 3 functions to show / update (when mouse move but stay on same circle) / hide the tooltip
                                    const showTooltip = function (event, d) {
                                        tooltip_y
                                            .transition()
                                            .duration(200)
                                        tooltip_y
                                            .style("opacity", 1)
                                            .html("Country: " + d.country)
                                    }

                                    // ---------------------------//
                                    //       HIGHLIGHT GROUP      //
                                    // ---------------------------//
                                    // What to do when one group is hovered
                                    const highlight = function (event, d) {
                                        // reduce opacity of all groups
                                        d3.selectAll(".bubbles").style("opacity", 1)
                                    }

                                    // And when it is not hovered anymore
                                    const noHighlight = function (event, d) {
                                        d3.selectAll(".bubbles").style("opacity", 1)
                                    }


                                    // ---------------------------//
                                    //       CIRCLES              //
                                    // ---------------------------//
                                    const dotto = svg_y.append('g')
                                        .selectAll("dot")
                                        .data(data)
                                        .join("circle")
                                        .attr("class", function (d) { return "bubbles " + d.Income_Group })
                                        .attr("cx", d => x(d.Pesticide_x))
                                        .attr("cy", d => y(d.Fertilizers_y))
                                        .attr("r", d => z(d.Yield_value))
                                        .style("fill", d => myColor(d.Income_Group))
                                        // -3- Trigger the functions for hover
                                        .on("mouseover", showTooltip)

                                    // ---------------------------//
                                    //       LEGEND              //
                                    // ---------------------------//

                                    // Add legend: circles
                                    const valuesToShow = [100000, 1000000, 10000000]
                                    const xCircle = 620
                                    const xLabel = 680
                                    svg_y
                                        .selectAll("legend")
                                        .data(valuesToShow)
                                        .join("circle")
                                        .attr("cx", xCircle)
                                        .attr("cy", d => height - 100 - z(d))
                                        .attr("r", d => z(d))
                                        .style("fill", "none")
                                        .attr("stroke", "black")

                                    // Add legend: segments
                                    svg_y
                                        .selectAll("legend")
                                        .data(valuesToShow)
                                        .join("line")
                                        .attr('x1', d => xCircle + z(d))
                                        .attr('x2', xLabel)
                                        .attr('y1', d => height - 100 - z(d))
                                        .attr('y2', d => height - 100 - z(d))
                                        .attr('stroke', 'black')
                                        .style('stroke-dasharray', ('2,2'))

                                    // Add legend: labels
                                    svg_y
                                        .selectAll("legend")
                                        .data(valuesToShow)
                                        .join("text")
                                        .attr('x', xLabel)
                                        .attr('y', d => height - 100 - z(d))
                                        .text(d => d / 100000)
                                        .style("font-size", 10)
                                        .attr('alignment-baseline', 'middle')

                                    // Legend title
                                    svg_y.append("text")
                                        .attr('x', xCircle)
                                        .attr("y", height - 100 + 30)
                                        .text("Hectogram / Hectare (Hg/Ha)")
                                        .attr("text-anchor", "middle")
                                    //annotation
                                    svg_y.append("text")
                                        .attr('x', 220)
                                        .attr("y", height - 100)
                                        .text("Countries yield similar hectograms of crops per hectare.")
                                        .attr("text-anchor", "middle")
                                        .style("font-size", "11px")
                                    svg_y.append("text")
                                        .attr('x', 220)
                                        .attr("y", height - 90)
                                        .text("Chemical additives have a limited benefit to crop production.")
                                        .attr("text-anchor", "middle")
                                        .style("font-size", "11px")
                                    // Add one dot in the legend for each name.
                                    const size = 20
                                    svg_y.selectAll("myrect")
                                        .data(allgroups)
                                        .join("circle")
                                        .attr("cx", 530)
                                        .attr("cy", (d, i) => i * (size + 5)) // 100 is where the first dot appears. 25 is the distance between dots
                                        .attr("r", 7)
                                        .style("fill", d => myColor(d))

                                    // Add labels beside legend dots
                                    svg_y.selectAll("mylabels")
                                        .data(allgroups)
                                        .enter()
                                        .append("text")
                                        .attr("x", 530 + size * .8)
                                        .attr("y", (d, i) => i * (size + 5) + (size / 2) - 10) // 100 is where the first dot appears. 25 is the distance between dots
                                        .style("fill", d => myColor(d))
                                        .text(d => d)
                                        .attr("text-anchor", "left")
                                        .style("alignment-baseline", "middle")
                                })

                        </script>
                    </div> <!-- section title -->
                </div>
            </div> <!-- row -->

        </div> <!-- row -->
        </div> <!-- container -->
    </section>

    <!--====== TEAM PART ENDS ======-->

    <!--====== BACK TOP TOP PART START ======-->

    <a href="#" class="back-to-top"><i class="lni lni-chevron-up"></i></a>

    <!--====== BACK TOP TOP PART ENDS ======-->


    <!--====== Bootstrap js ======-->
    <script src="assets/js/bootstrap.bundle-5.0.0-beta1.min.js"></script>

    <!--====== glide js ======-->
    <script src="assets/js/tiny-slider.js"></script>

    <!--====== wow js ======-->
    <script src="assets/js/wow.min.js"></script>

    <!--====== Main js ======-->
    <script src="assets/js/main.js"></script>

</body>

</html>
